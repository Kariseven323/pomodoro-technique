# PRD v5 - UI 重构：轻量化 iOS 风格（含少量后端配合）

## 概述

本次重构以 UI 为主，原则上复用现有能力；但为对齐交互与信息架构，允许引入**少量后端/IPC 调整**（例如标签 CRUD、迷你模式阶段结束行为）。核心目标：**轻量化、iOS 化、设计语言统一**。

---

## 1. 导航结构

### 1.1 底部 TabBar

替换当前顶部 header + 页签布局，采用 iOS 风格底部导航：

```
┌─────────────────────────────────────┐
│                                     │
│           页面内容区域               │
│                                     │
├─────────────────────────────────────┤
│   ⏱️ 计时    📊 历史    ⚙️ 设置     │
└─────────────────────────────────────┘
```

- 3 个 tab：计时（主页）、历史、设置
- 选中态：图标 + 文字高亮
- 未选中态：灰色图标 + 文字

### 1.2 页面层级

```
/                 → 计时页（默认）
/history          → 历史页
/settings         → 设置页（新增）
/settings/blacklist → 黑名单管理（子页面）
```

---

## 2. 计时页（主页）

### 2.1 布局

```
┌─────────────────────────────────────┐
│                                     │
│         ┌───────────────┐           │
│         │               │           │
│         │   25:00       │  ← 圆形进度环
│         │    工作       │    内部：时间 + 阶段
│         │               │
│         └───────────────┘           │
│                                     │
│         [ 工作 ▼ ]                  │  ← 标签选择器（pill 样式）
│                                     │
│    ┌────────┐  ┌────┐  ┌────┐      │
│    │  开始  │  │重置│  │跳过│      │  ← 控制按钮
│    └────────┘  └────┘  └────┘      │
│                                     │
├─────────────────────────────────────┤
│   ⏱️ 计时    📊 历史    ⚙️ 设置     │
└─────────────────────────────────────┘
```

### 2.2 圆形进度环

- 直径：屏幕宽度 60%（最大 280px）
- 进度环宽度：8px
- 颜色：
  - 工作阶段：`#EF4444`（红色）
  - 短休息：`#22C55E`（绿色）
  - 长休息：`#3B82F6`（蓝色）
- 背景环：`rgba(0,0,0,0.05)` / dark: `rgba(255,255,255,0.1)`
- 内部文字：
  - 时间：`text-4xl font-bold tabular-nums`
  - 阶段：`text-sm text-zinc-500`

### 2.3 标签选择器

- 位置：进度环下方，居中
- 样式：pill 按钮，点击展开下拉菜单
- 下拉菜单：iOS 风格 action sheet（底部弹出）
- 标签能力：支持标签的**增删改查（CRUD）**，用于任务分类与历史统计
  - 选择：从标签列表中选择
  - 新增：在 action sheet 中提供“新增标签”入口
  - 编辑/删除：在 action sheet 中提供“管理标签”入口（进入管理页或弹窗，提供重命名/删除）
  - 后端配合：需要补齐标签管理相关 IPC（当前仅有“新增/设置当前标签”不足以覆盖 CRUD）

### 2.4 控制按钮

- 主按钮（开始/暂停）：实心，宽度 120px
- 次要按钮（重置/跳过）：描边，宽度 64px
- 间距：`gap-3`

### 2.5 移除内容

以下内容从主页移除：

- 今日完成数 → 移至历史页
- Combo 显示 → 移至历史页
- 今日中断次数 → 移至历史页
- 音频控制 → 移至设置页
- 管理员提权提示 → 保留为 toast 通知

---

## 3. 迷你模式

### 3.0 入口与范围

- **入口：托盘右键菜单**（作为主入口；主窗口 UI 不强制提供“进入迷你模式”按钮）
- 迷你模式仅影响主窗口显示形态与尺寸，不改变计时逻辑

### 3.1 布局

```
┌─────────────────┐
│     25:00       │  ← 仅显示剩余时间
└─────────────────┘
```

- 窗口尺寸：200x80px
- 内容：仅剩余时间（大字）
- 背景色：根据阶段变化（工作红/休息绿蓝）
- 无按钮、无其他信息

### 3.2 退出行为

- 阶段结束时：
  - 若「自动继续」关闭 → 自动退出迷你模式
  - 若「自动继续」开启 → 保持迷你模式
- 实现说明：阶段结束由计时器状态变化驱动；需要在前端或后端监听“阶段结束/切换”并在满足条件时调用 `set_mini_mode(false)`

---

## 4. 历史页

### 4.1 布局

```
┌─────────────────────────────────────┐
│  历史记录                    导出    │
├─────────────────────────────────────┤
│  [ 日 ] [ 周 ] [ 月 ]               │  ← 视图切换
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐    │
│  │      日历热力图              │    │
│  └─────────────────────────────┘    │
├─────────────────────────────────────┤
│  今日统计                           │
│  ┌────────┐ ┌────────┐ ┌────────┐  │
│  │完成 8  │ │中断 2  │ │连击 5  │  │
│  └────────┘ └────────┘ └────────┘  │
├─────────────────────────────────────┤
│  记录列表                           │
│  ┌─────────────────────────────┐    │
│  │ 2025-01-03                  │    │
│  │ ├─ 09:00 工作 25min         │    │
│  │ └─ 09:30 短休息 5min        │    │
│  └─────────────────────────────┘    │
├─────────────────────────────────────┤
│  专注分析          中断分析          │
│  ┌────────────┐   ┌────────────┐   │
│  │ 高峰时段   │   │ 中断原因   │   │
│  │ 09:00-11:00│   │ 分布图     │   │
│  └────────────┘   └────────────┘   │
├─────────────────────────────────────┤
│   ⏱️ 计时    📊 历史    ⚙️ 设置     │
└─────────────────────────────────────┘
```

### 4.2 今日统计卡片

从主页移来，包含：

- 完成数
- 中断数
- 当前连击（Combo）

### 4.3 保留内容

- 日历热力图
- 日/周/月视图切换
- 记录列表（可展开）
- 专注分析
- 中断分析
- 导出功能

---

## 5. 设置页

### 5.1 布局

采用 iOS 分组列表风格：

```
┌─────────────────────────────────────┐
│  设置                               │
├─────────────────────────────────────┤
│  计时器                             │
│  ┌─────────────────────────────┐    │
│  │ 工作时长              25 分钟│    │
│  │ 短休息时长             5 分钟│    │
│  │ 长休息时长            15 分钟│    │
│  │ 长休息间隔             4 个  │    │
│  └─────────────────────────────┘    │
│                                     │
│  自动继续                           │
│  ┌─────────────────────────────┐    │
│  │ 启用自动继续            [开关]│    │
│  │ 连续番茄钟数            4 个  │    │
│  └─────────────────────────────┘    │
│                                     │
│  目标                               │
│  ┌─────────────────────────────┐    │
│  │ 每日目标               8 个  │    │
│  │ 每周目标              40 个  │    │
│  │ 窗口置顶              [开关] │    │
│  └─────────────────────────────┘    │
│                                     │
│  音频                               │
│  ┌─────────────────────────────┐    │
│  │ 启用音效              [开关] │    │
│  │ 自动播放              [开关] │    │
│  │ 提示音选择               >    │    │
│  │ 音量                 60%  >  │    │
│  │ 试听播放/暂停             >   │    │
│  │ 管理自定义音频            >   │    │
│  └─────────────────────────────┘    │
│                                     │
│  动画                               │
│  ┌─────────────────────────────┐    │
│  │ 启用动画              [开关] │    │
│  │ 连击动画              [开关] │    │
│  │ 动画强度             标准 >  │    │
│  └─────────────────────────────┘    │
│                                     │
│  中断追踪                           │
│  ┌─────────────────────────────┐    │
│  │ 启用中断追踪          [开关] │    │
│  │ 中断时确认            [开关] │    │
│  └─────────────────────────────┘    │
│                                     │
│  黑名单管理                    >    │  ← 独立入口
│                                     │
│  关于                               │
│  ┌─────────────────────────────┐    │
│  │ 数据存储路径（总入口，只读） │    │
│  │ 打开数据文件夹               │    │
│  │ 版本                   1.0.0 │    │
│  └─────────────────────────────┘    │
├─────────────────────────────────────┤
│   ⏱️ 计时    📊 历史    ⚙️ 设置     │
└─────────────────────────────────────┘
```

### 5.2 黑名单管理

- 独立入口，点击进入子页面 `/settings/blacklist`
- 子页面顶部显示返回按钮
- 保留现有黑名单管理功能：
  - 运行中进程列表
  - 黑名单列表
  - 模板管理

### 5.3 音频控制（复用现有后端能力）

- 原则：不新增音频能力，**保留并复用后端现有实现**（音效启用/自动播放/提示音选择/音量/导入删除）
- 设置页需提供完整入口，避免仅展示“开关/选择”导致能力丢失

### 5.4 设置项即时生效

- 所有设置项变更后立即保存，无需「保存」按钮
- 移除设置模态框
- 输入类型建议：
  - 开关：变更即保存
  - 数值步进器/滑条：可即时保存，但需考虑节流（避免高频写入）

---

## 6. 设计规范

### 6.1 圆角

统一使用 `rounded-2xl`（16px）：

- 卡片
- 按钮
- 输入框
- 分组容器

### 6.2 间距

- 页面内边距：`p-4`
- 卡片内边距：`p-4`
- 元素间距：`gap-4`
- 分组间距：`mt-6`

### 6.3 颜色

保持现有 zinc 灰阶，简化层次：

| 用途   | Light      | Dark       |
| ------ | ---------- | ---------- |
| 背景   | `zinc-50`  | `zinc-950` |
| 卡片   | `white`    | `zinc-900` |
| 分组   | `zinc-100` | `zinc-800` |
| 文字主 | `zinc-900` | `zinc-50`  |
| 文字次 | `zinc-500` | `zinc-400` |
| 边框   | `zinc-200` | `zinc-700` |

### 6.4 按钮

| 类型     | 样式                                                                           |
| -------- | ------------------------------------------------------------------------------ |
| 主按钮   | `bg-zinc-900 text-white` / dark: `bg-white text-zinc-900`                      |
| 次要按钮 | `border border-zinc-200 text-zinc-700` / dark: `border-zinc-700 text-zinc-300` |
| 文字按钮 | `text-zinc-500 hover:text-zinc-900`                                            |

### 6.5 移除效果

- 移除 `backdrop-blur`（毛玻璃）
- 移除 `shadow-xl`（重阴影）
- 保留 `shadow-sm`（轻阴影）

---

## 7. 组件变更清单

### 7.1 新增组件

| 组件               | 路径                                         | 说明             |
| ------------------ | -------------------------------------------- | ---------------- |
| `TabBar`           | `src/lib/components/TabBar.svelte`           | 底部导航栏       |
| `CircularProgress` | `src/lib/components/CircularProgress.svelte` | 圆形进度环       |
| `SettingsGroup`    | `src/lib/components/SettingsGroup.svelte`    | iOS 风格分组列表 |
| `SettingsRow`      | `src/lib/components/SettingsRow.svelte`      | 设置项行         |

### 7.2 修改组件

| 组件                   | 变更                                  |
| ---------------------- | ------------------------------------- |
| `+page.svelte`         | 移除统计卡片，简化为计时器 + 控制按钮 |
| `+layout.svelte`       | 添加 TabBar                           |
| `TimerCard.svelte`     | 重构为圆形进度环布局                  |
| `StatsCard.svelte`     | 移至历史页                            |
| `MiniWindow.svelte`    | 简化为仅显示时间                      |
| `history/+page.svelte` | 添加今日统计卡片                      |

### 7.3 移除组件

| 组件                    | 原因           |
| ----------------------- | -------------- |
| `SettingsModal.svelte`  | 改为独立页面   |
| `BlacklistModal.svelte` | 改为独立页面   |
| `MoreMenu.svelte`       | 功能移至设置页 |

### 7.4 新增路由

| 路由                  | 说明         |
| --------------------- | ------------ |
| `/settings`           | 设置页       |
| `/settings/blacklist` | 黑名单管理页 |

---

## 8. 迁移策略

### 8.1 阶段一：基础结构

1. 创建 TabBar 组件
2. 创建设置页路由
3. 创建黑名单管理页路由
4. 修改 `+layout.svelte` 添加 TabBar

### 8.2 阶段二：主页重构

1. 创建 CircularProgress 组件
2. 重构 TimerCard 为圆形布局
3. 移除主页统计内容
4. 调整标签选择器位置

### 8.3 阶段三：设置页实现

1. 创建 SettingsGroup/SettingsRow 组件
2. 迁移设置模态框内容到设置页
3. 实现即时保存逻辑
4. 迁移黑名单模态框到子页面

### 8.3.x 标签管理能力补齐（少量后端 + 前端）

1. 补齐标签 CRUD 的 IPC/持久化与校验
2. 在标签选择 action sheet 中加入“新增/管理”入口
3. 增加标签管理页或弹窗（重命名/删除）

### 8.4 阶段四：历史页调整

1. 添加今日统计卡片
2. 调整布局适配新设计规范

### 8.5 阶段五：迷你模式

1. 简化 MiniWindow 布局
2. 实现阶段结束自动退出逻辑

---

## 9. 验收标准

- [ ] 底部 TabBar 正常切换
- [ ] 圆形进度环正确显示进度和阶段颜色
- [ ] 标签选择器功能正常
- [ ] 设置页所有设置项可编辑且即时生效
- [ ] 黑名单管理页功能完整
- [ ] 历史页显示今日统计
- [ ] 迷你模式仅显示时间
- [ ] 迷你模式阶段结束正确退出/保持
- [ ] 深色模式适配正常
- [ ] 所有圆角、间距、颜色符合设计规范
